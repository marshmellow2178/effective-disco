<html layout:decorate = "~{layout}">
<main class="container" layout:fragment = "content">
    <hr>
    <section class="place_info">
		<img th:unless= "${place.ctgr == ''}" th:src="@{${'/img/'+place.ctgr+'.png'}}" id = "dest_img">
		<img th:if = "${place.ctgr==''}" src="/img/all.png" id = "dest_img">
		<div>
			<b th:text = "${place.placename}"></b>
			<span th:text = "|평점: ${place.getScores[0]/place.reviewList.size()}|"></span>
			<p th:text = "${place.addr}"></p>
		</div>
	</section>
	<hr>
 	<form th:if = "${myReview == null}" action = "/review/create" method = "post">
 		<input type = "hidden" th:value = "${param.id}" name = "placeid">
 		<div class = "input-group">
 			<span class = "input-group-text">평점</span>
 			<input type = "number" min = "1" max = "5" name = "score" class = "form-control col-2">
 		</div>
 		<textarea class = "form-control my-3" name = "content" rows = "5">내용</textarea>
 		<input type = "submit" class = "btn btn-custom" value = "제출">
	</form>
	<div th:unless = "${myReview == null}" action = "/modifyReview" method = "post">
		<b th:text = "${myReview.uid}"></b>
		<span th:if = "${myReview.modifyDate == null}" th:text = "${#temporals.format(myReview.createDate, 'MM-dd HH:mm')}"></span>
	 	<span th:unless= "${myReview.modifyDate == null}" th:text = "|${#temporals.format(myReview.modifyDate, 'MM-dd HH:mm')} (수정됨)|"></span> 		
	 	<span th:text = "|평점: ${myReview.score}|"></span>
 		<p th:text = "${myReview.content}"></p>
 		<a th:href = "@{|/review/modify?id=${myReview.id}&place=${place.id}|}" role = "button" class = "btn btn-custom">수정</a>
 		<a href = "javascript:void(0);" role = "button" class = "btn btn-danger" id = "del_btn">삭제</a>
 	</div>
 	<hr>
 	<form id = "review_search_form" class = "input-group align-items-center justify-content-between">
	 	<input type = "hidden" name = "id" th:value = "${param.id}">
	 	<input type = "hidden" name = "page" th:value = "${param.page}" id = "page_input">
	 	<span th:text = "|${reviewPage.getTotalElements}개의 리뷰가 있습니다|"></span>
	 	<select class = "form-control col-3" name = "order" id = "order_input">
	 		<option value = "recommend" th:selected = "${param.order} == 'recommend'">중요도순</option>
	 		<option value = "createDate" th:selected = "${param.order} == 'createDate'">최신순</option>
	 	</select>
 	</form>
 	<hr>
 	<div th:unless = "${reviewPage.isEmpty()}">
	 	<ul class = "list-group">
	 		<li class = "list-group-item" th:each = "review : ${reviewPage}">
	 			<b th:text = "${review.uid}"></b>
	 			<span th:if = "${review.modifyDate == null}" th:text = "${#temporals.format(review.createDate, 'MM-dd HH:mm')}"></span>
	 			<span th:unless= "${review.modifyDate == null}" th:text = "|${#temporals.format(review.modifyDate, 'MM-dd HH:mm')} (수정됨)|"></span>
	 			<span th:text = "|평점: ${review.score}|"></span>
	 			<p th:text = "${review.content}"></p>
	 			<button class = "btn btn-custom">자세히 보기</button>
	 		</li>
	 	</ul>
	 	
	 	<hr>
	 	<ul class = "pagination justify-content-center">
	 	<th:block th:with = "block = 10,
	 	sidx = ${(reviewPage.number/block)*block+1}, 
	 	eidx = ${(reviewPage.totalPages > sidx+(block-1) ? sidx+(block-1) : reviewPage.totalPages)}">
	 		<li class = "page-item" th:classappend="!${reviewPage.hasPrevious} ? disabled">
	 			<a class = "page-link" th:data-page = "${sidx}-1">&lt;</a>
	 		</li>
	 		<li th:each = "idx:${#numbers.sequence(sidx, eidx)}"
	 			th:text = "${reviewPage.number}"
	 			class = "page-item"
	 			th:classappend = "${reviewPage.number == param.page} ? active">
	 			<a class = "page-link" th:text = "${idx}" th:data-page = "${idx}"></a>
	 		</li>
	 		<li class = "page-item" th:classappend="!${reviewPage.hasNext} ? disabled">
	 			<a class = "page-link" th:data-page = "${eidx+1}">&gt;</a>
	 		</li>
	 	</th:block>
	 	</ul>
 	</div>
 	<div th:if = "${reviewPage.isEmpty()}">
 		 작성된 리뷰가 없습니다
 	</div>
 	<hr>
 	<script>
	let delBtn = document.querySelector("#del_btn");
	let reviewSearchForm = document.querySelector('#review_search_form');
	let pageInput = document.querySelector("#page_input");
	let orderInput = document.querySelector('#order_input');
	let pageItems = document.querySelectorAll(".page-item");
	
	orderInput.addEventListener('change', function(){
		reviewSearchForm.submit();
	});
	
	pageItems.forEach(function(item){
		item.addEventListener('click', function(){
			pageInput.value = this.dataset.page;
			reviewSearchForm.submit();
		});
	});
	
	delBtn.addEventListener('click', function(){
		if(confirm('정말 삭제하시겠습니까?')){
			location.href = "/review/delete";
		}
	});
 	</script>
</main>
</html>