<html layout:decorate="~{layout}">
<main class="container" layout:fragment="content">
	<hr>
	<form name = "searchForm" class="input-group mt-3">
		<input type = "text" class = "form-control" id = "start_name">
		<span class = "input-group-text">▶</span>
		<input type = "text" class = "form-control" th:value = "${place.placename}">
	</form>
	<hr>
	<div class="map_wrap">
		<div id="map"></div>
	</div>
	<hr>

	<section class="place_info">
		<input type= "hidden" id = "place_x" th:value = "${place.longitude}">
		<input type= "hidden" id = "place_y" th:value = "${place.latitude}">
		<img th:if = "${place.ctgr==''}" src="/img/all.png" id = "dest_img">
		<img th:unless = "${place.ctgr==''}" th:src="@{${'/img/'+place.ctgr+'.png'}}" id = "dest_img">
		<div>
			<b th:text = "${place.placename}"></b>
			<p th:text = "${place.addr}"></p>
			<a th:href = "@{|/review/list?id=${place.id}|}">리뷰</a>
		</div>
	</section>
	<hr>
	<script defer src= "/js/map.js"></script>
	<script>
	let placeX = document.querySelector("#place_x");
	let placeY = document.querySelector("#place_y");
	let startName = document.querySelector("#start_name");
	
	function success(pos){
		let destLat = Number(placeY.value);
		let destLng = Number(placeX.value);
		let startLat = pos.coords.latitude;
		let startLng = pos.coords.longitude;
		
		let currentPos = new kakao.maps.LatLng(startLat, startLng);
		let centerPos = new kakao.maps.LatLng((startLat+destLat)/2, (startLng+destLng)/2);
		drawMap(centerPos);
		//map.setBounds()
		let currentMarker = new kakao.maps.Marker({
			map:map,
		    position: currentPos,
		    image: markerImage
		});
		let destMarker = new kakao.maps.Marker({
	        map: map,
	        position: new kakao.maps.LatLng(destLat, destLng)
	    });
		
		geocoder.coord2Address(currentPos.getLng(), currentPos.getLat(), function(result, status){
			if (status === kakao.maps.services.Status.OK) {
				let content = result[0].address.address_name;
				startName.value = content;
			}
		});
		
	}//현재위치 로드

	</script>
</main>
</html>