<html layout:decorate = "~{layout}">
<main class="container" layout:fragment = "content"
	th:with = "reviewCounts = ${reviewPage.getTotalElements},
	sort = ${param.sort == null ? 'r' : param.sort}">

    <section class="cmp_info d-flex">
    	<div class = "cmp_details col-2">
			<span id = "dest_score"
			th:text = "|â­ ${cmp.score} (ðŸ’¬ ${cmp.cmpReviewCnt})|"></span>
		</div>
		<table class = "table table-sm col-4 table-borderless">
			<tr th:each = "idx:${#numbers.sequence(4, 0)}">
				<th scope = "row" 
				class = "col-2" 
				th:text = "|â­ ${idx+1}|"></th>
				<td class = "col-4">
					<input type = "range" 
					min = 0 th:max = "${reviewCounts}" 
					th:value = ${scoreArr[idx]} 
					disabled
					></td>
				<td th:text = "|ðŸ’¬ ${scoreArr[idx]}|"
				class ="col-2"
				></td>
			</tr>
		</table>
	</section>
 	<!--ë¦¬ë·° ì •ë ¬ í¼ -->
 	
 	<form id = "review_search_form" class = "input-group align-items-center justify-content-between">
	 	<input type = "hidden" name = "id" th:value = "${param.id}">
	 	<input type = "hidden" name = "page" th:value = "${param.page}" id = "page_input">
	 	<span th:text = "|${reviewCounts}ê°œì˜ ë¦¬ë·°ê°€ ìžˆìŠµë‹ˆë‹¤|"></span>
	 	<select class = "form-control col-3" name = "sort" id = "order_input">
	 		<option value = "r" th:selected = "${#strings.equals(param.sort, 'r')}">ì¶”ì²œìˆœ</option>
	 		<option value = "d" th:selected = "${#strings.equals(param.sort, 'd')}">ìµœì‹ ìˆœ</option>
	 	</select>
 	</form>
 	
 	<!--ë¦¬ë·° ì¶œë ¥ -->
 	
 	<div th:unless = "${reviewCounts}==0">
	 	<ul class = "list-group my-3">
	 		<li class = "list-group-item review_item" th:each = "review : ${reviewPage}">
	 			<div class = "review_title">
	 				<span th:text = "|â­ ${review.score}|"></span>
	 				<b th:text = "${review.uid}" class = "user_id"></b>
	 				<span th:if = "${review.modifyDate == null}" th:text = "${#temporals.format(review.createDate, 'yy/MM/dd')}"></span>
	 				<span th:unless= "${review.modifyDate == null}" th:text = "|${#temporals.format(review.modifyDate, 'yy/MM/dd')} (ìˆ˜ì •ë¨)|"></span>
	 			</div>
	 			<div>
	 				<p th:id = "|content${review.id}|"  
	 				th:text = "${review.content}" class = "review_content"></p>
	 			</div>
 				<div>
 					<span class = "btn btn-sm btn-outline-disabled" 
 					th:text = "|ðŸ‘ ${review.recCount}|"></span>
					<a href = "javascript:void(0);" 
					class = "btn btn-sm btn-danger"
					id = "del_btn" 
					th:data-uri = "@{|/review/delete?id=${review.id}|}">ì‚­ì œ</a>
				</div>
				
	 		</li>
	 	</ul>
	 	
	 	<!--íŽ˜ì´ì§• -->
	 	
	 	<ul class = "pagination justify-content-center" 
	    th:if = "${reviewPage.totalPages} != 0"
	 	th:with = "block = 10,
	 	total = ${reviewPage.totalPages},
	 	number = ${reviewPage.number+1},
	 	sidx = ${(number/block)*block+1}, 
	 	eidx = ${(total > sidx+(block-1) ? sidx+(block-1) : total)}">
	 		<li class = "page-item" 
	 		th:classappend="${number} == 1 ? disabled">
	 			<a class = "page-link" 
	 			th:href = "@{|/review/cmp/list?name=${cmp.cmpName}&sort=${sort}&page=${number-1}|}">&lt;</a>
	 		</li>
	 		<th:block th:each = "idx:${#numbers.sequence(sidx, eidx)}">
	 		<li class = "page-item" 
	 		th:classappend="${number}==${idx} ? active">
	 			<a class = "page-link" 
	 			th:text = "${idx}" 
	 			th:href = "@{|/review/cmp/list?name=${cmp.cmpName}&sort=${sort}&page=${idx}|}" ></a>
	 		</li>
	 		</th:block>
	 		<li class = "page-item" 
	 		th:classappend="!${reviewPage.hasNext} ? disabled">
	 			<a class = "page-link" 
	 			th:href = "@{|/review/cmp/list?name=${cmp.cmpName}&sort=${sort}&page=${number+1}|}">&gt;</a>
	 		</li>
 		</ul>
 	</div>
 	<hr>
 	<script>
	let delBtn = document.querySelector("#del_btn");
	let reviewSearchForm = document.querySelector('#review_search_form');
	let pageInput = document.querySelector("#page_input");
	let orderInput = document.querySelector('#order_input');
	let pageLinks = document.querySelectorAll(".page-link");
	let navReview = document.querySelector('#nav_review');
	navReview.classList.add('active');
	
	orderInput.addEventListener('change', function(){
		reviewSearchForm.submit();
	});
	
	pageLinks.forEach(function(item){
		item.addEventListener('click', function(){
			pageInput.value = this.dataset.page;
			reviewSearchForm.submit();
		});
	});
	
	delBtn.addEventListener('click', function(){
		if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
			location.href = this.dataset.uri;
		}
	});
	
	let reviewContents = document.querySelectorAll(".review_content");
	let showClass = 'show';

	reviewContents.forEach(function(p){
		if(p.offsetHeight >= 72 && p.id != "") { //1rem = 10px
			let btn = document.createElement("span");
			btn.classList.add('btn');
			btn.classList.add('btn-sm');
			btn.classList.add('btn-toggle');
			btn.innerText = "more";
			btn.setAttribute('id','more'+p.id.substring(7)); //píƒœê·¸ id í•„ìˆ˜
			btn.addEventListener('click', function(event){
				let btnId = event.target.id.substring(4);
				let targetContent = document.querySelector('#content'+btnId);
				if(targetContent.classList.contains(showClass)){
					targetContent.classList.remove(showClass);
					event.target.innerText = "more";
				}else{
					targetContent.classList.add(showClass);
					event.target.innerText = "hide";
				}
			})
			p.parentElement.appendChild(btn);
		}
	});
 	</script>
</main>
</html>