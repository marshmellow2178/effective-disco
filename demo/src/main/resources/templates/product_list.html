<html layout:decorate="~{layout}">
<main class = "container"  layout:fragment="content">
	<p th:text = "|${param.cmp}의 상품 ${products.totalElements}개|"></p>
	<ul th:if = "${products} != null" 
	class = "receipt_list container-fluid">
        <li th:each = "product: ${products}" 
        class = "receipt card p-3">
        	<img th:src = "@{|/img/product.png|}">
        	<b th:text = "|${product.name}|"></b>
        	<span th:text = "|${product.price}원|"></span>
        	<div class = "button-group">
	        	<button th:id = "${product.id}"
	        	class = "add_cart btn btn-sm btn-outline-custom col-5">
	        		카트담기
	        	</button>
	        	<a th:href = "@{|/order/instant?id=${product.id}|}"
	        	class = "btn btn-sm btn-outline-custom col-5">
	        		바로구매
	        	</a>
        	</div>
        </li>
    </ul>
    <ul class = "pagination justify-content-center" 
    th:if = "${products.totalPages} != 0"
 	th:with = "block = 10,
 	total = ${products.totalPages},
 	number = ${products.number+1},
 	sidx = ${(number/block)*block+1}, 
 	eidx = ${(total > sidx+(block-1) ? sidx+(block-1) : total)}">
 		<li class = "page-item" 
 		th:classappend="${number} == 1 ? disabled">
 			<a class = "page-link" 
 			th:href = "@{|/product/list?page=${number-1}|}">&lt;</a>
 		</li>
 		<th:block th:each = "idx:${#numbers.sequence(sidx, eidx)}">
 		<li class = "page-item" 
 		th:classappend="${number}==${idx} ? active">
 			<a class = "page-link" 
 			th:text = "${idx}" 
 			th:href = "@{|/product/list?page=${idx}|}" ></a>
 		</li>
 		</th:block>
 		<li class = "page-item" 
 		th:classappend="!${products.hasNext} ? disabled">
 			<a class = "page-link" 
 			th:href = "@{|/product/list?page=${number+1}|}">&gt;</a>
 		</li>
 	</ul>
 	<script type="text/javascript">
	let navOrder = document.querySelector('#nav_order');
	let addCartLinks = document.querySelectorAll('.add_cart')
	navOrder.classList.add('active');
	for(let i = 0;i<addCartLinks.length;i++){
		let e = addCartLinks[i];
		e.addEventListener('click', function(event){
			let pid = event.target.id;
			fetch('/cart/add?id='+pid, {
				method: 'post',
				headers: {
					'content-type': 'application/json'
				},
				body: JSON.stringify({
					productId: pid,
					count: 1,
				}),
			})
			.then(response=>{
				if(response.ok){
					alert('카트에 상품을 넣었습니다');
				}
			});
		})
	}
	</script>
</main>
</html>